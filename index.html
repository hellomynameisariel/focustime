<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FocusTime</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background-color: black;
      color: white;
      transition: background-color 1s ease;
    }

    select, button {
      font-size: 1rem;
      margin: 0.25rem;
    }

    .status {
      padding: 0.5rem 1rem;
      margin-top: 1rem;
      border-radius: 5px;
      font-size: 1.2rem;
    }

    .yellow { background-color: #fff3b0; color: black; }
    .green { background-color: #caffbf; color: black; }
    .red { background-color: #ffadad; color: black; }
    .blue { background-color: #a0c4ff; color: black; }

    #resetBtn {
      margin-top: 1.5rem;
      padding: 0.5rem 1rem;
      background: #444;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>FocusTime</h1>
  <label>Start Hour:
    <select id="hourSelect"></select>
  </label>
  <label>Start Minute:
    <select id="minuteSelect">
      <option value="0">:00</option>
      <option value="15">:15</option>
      <option value="30">:30</option>
      <option value="45">:45</option>
    </select>
  </label>
  <label>Duration:
    <select id="durationSelect">
      <option value="25">25 minutes</option>
      <option value="50">50 minutes</option>
      <option value="75">75 minutes</option>
    </select>
  </label>
  <button onclick="startSession()">Start</button>

  <div id="status" class="status"></div>
  <button id="resetBtn" onclick="confirmReset()">Reset</button>

  <script>
    const hourSelect = document.getElementById("hourSelect");
    const now = new Date();
    const currentHour = now.getHours();
    [currentHour - 1, currentHour, currentHour + 1].forEach(hour => {
      const option = document.createElement("option");
      option.value = hour;
      option.text = `${hour}:00`;
      hourSelect.appendChild(option);
    });
    hourSelect.value = currentHour;

    let interval;
    const statusDiv = document.getElementById("status");

    function lightenColor(baseColor, percent) {
      const amt = Math.round(255 * percent);
      const hex = (c) => c.toString(16).padStart(2, "0");
      return `rgb(${amt}, ${amt}, ${amt})`;
    }

    function startSession() {
      const startHour = parseInt(hourSelect.value);
      const startMinute = parseInt(minuteSelect.value);
      const duration = parseInt(durationSelect.value);

      const start = new Date();
      start.setHours(startHour, startMinute, 0, 0);

      const end = new Date(start.getTime() + duration * 60000);
      localStorage.setItem("focusStart", start.getTime());
      localStorage.setItem("focusEnd", end.getTime());
      localStorage.setItem("focusDuration", duration);
      if (interval) clearInterval(interval);
      runTimer();
      interval = setInterval(runTimer, 1000);
    }

    function runTimer() {
      const start = parseInt(localStorage.getItem("focusStart"));
      const end = parseInt(localStorage.getItem("focusEnd"));
      const duration = parseInt(localStorage.getItem("focusDuration"));
      const now = new Date().getTime();

      if (!start || !end || !duration) return;

      if (now < start) {
        const timeLeft = Math.floor((start - now) / 1000);
        if (timeLeft <= 120) {
          statusDiv.textContent = `Session starts in: ${formatTime(timeLeft)}`;
          statusDiv.className = "status green";
        } else {
          statusDiv.textContent = `Time until next session: ${formatTime(timeLeft)}`;
          statusDiv.className = "status yellow";
        }
        document.body.style.backgroundColor = "black";
      } else if (now < end) {
        const timeLeft = Math.floor((end - now) / 1000);
        statusDiv.textContent = `Time in session remaining: ${formatTime(timeLeft)}`;
        if (timeLeft <= 120) {
          statusDiv.className = "status red";
          document.body.style.backgroundColor = "#ffadad";
        } else {
          const elapsed = duration * 60 - timeLeft;
          const lightenStep = (duration === 25) ? 300 : (duration === 50 ? 600 : 900);
          const stepCount = Math.floor(elapsed / lightenStep);
          const percent = stepCount / (duration / (lightenStep / 60));
          document.body.style.backgroundColor = lightenColor("#000000", percent);
          statusDiv.className = "status";
        }
      } else {
        const overTime = Math.floor((now - end) / 1000);
        statusDiv.textContent = `Session complete. Time since end: ${formatTime(overTime)}`;
        statusDiv.className = "status blue";
        document.body.style.backgroundColor = "#a0c4ff";
      }
    }

    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return `${m}:${s.toString().padStart(2, '0')}`;
    }

    function confirmReset() {
      if (confirm("Do you really want to reset?")) {
        localStorage.removeItem("focusStart");
        localStorage.removeItem("focusEnd");
        localStorage.removeItem("focusDuration");
        location.reload();
      }
    }

    // Auto-resume
    if (localStorage.getItem("focusStart")) {
      runTimer();
      interval = setInterval(runTimer, 1000);
    }
  </script>
</body>
</html>
